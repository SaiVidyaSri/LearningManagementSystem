<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress - LearNova</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="navbar.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
</head>
<body>
    <!-- Navbar will be inserted here by navbar.js -->

    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <section style="margin-bottom: 3rem;">
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h1 style="margin-bottom: 1rem;">Learning Progress üìä</h1>
                    <p style="opacity: 0.9; font-size: 1.1rem;">Track your achievements and see how far you've come in your learning journey.</p>
                </div>
            </section>

            <!-- Overall Statistics -->
            <section style="margin-bottom: 3rem;">
                <h2 style="margin-bottom: 2rem; color: #333;">Overall Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalCourses">0</div>
                        <div class="stat-label">Total Courses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedCourses">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuizzes">0</div>
                        <div class="stat-label">Quizzes Taken</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averageScore">0%</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                </div>
            </section>

            <!-- Course Selection -->
            <section style="margin-bottom: 3rem;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h3 style="margin-bottom: 0.5rem; color: #333;">Select Course</h3>
                            <p style="color: #666; margin: 0;">Choose a course to view detailed progress</p>
                        </div>
                        <div style="min-width: 250px;">
                            <select id="courseSelect" class="form-control">
                                <option value="">All Courses Overview</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Progress Overview -->
            <section id="overviewSection">
                <h2 style="margin-bottom: 2rem; color: #333;">Progress Overview</h2>
                <div id="progressOverview">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </section>

            <!-- Detailed Course Progress -->
            <section id="detailedSection" style="display: none;">
                <h2 style="margin-bottom: 2rem; color: #333;">Detailed Progress</h2>
                
                <!-- Course Progress Summary -->
                <div id="courseProgressSummary" style="margin-bottom: 3rem;"></div>
                
                <!-- Module Progress -->
                <div style="margin-bottom: 3rem;">
                    <h3 style="margin-bottom: 1.5rem; color: #333;">Module Progress</h3>
                    <div id="moduleProgress"></div>
                </div>
                
                <!-- Quiz Results -->
                <div style="margin-bottom: 3rem;">
                    <h3 style="margin-bottom: 1.5rem; color: #333;">Quiz Results</h3>
                    <div id="quizResults"></div>
                </div>
                
                <!-- Final Exam -->
                <div>
                    <h3 style="margin-bottom: 1.5rem; color: #333;">Final Exam</h3>
                    <div id="finalExamResult"></div>
                </div>
            </section>
        </div>
    </main>

    <footer style="background: #333; color: white; padding: 2rem 0; text-align: center; margin-top: 4rem;">
        <div class="container">
            <p>&copy; 2025 LearNova. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentUser = null;
        let allProgressData = [];
        let selectedCourse = null;

        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('token');
            // Check both 'user' and 'userData' for compatibility
            const user = localStorage.getItem('userData') || localStorage.getItem('user');
            
            if (!token || !user) {
                window.location.href = 'login.html';
                return null;
            }
            
            currentUser = JSON.parse(user);
            // Remove this line since navbar will handle the welcome message
            // document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.username}!`;
            return currentUser;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        }

        // Load progress data
        async function loadProgressData() {
            if (!currentUser) return;

            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                const response = await fetch('/api/student-progress-details', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // Token is invalid, redirect to login
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        window.location.href = 'login.html';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                allProgressData = await response.json();
                
                populateCourseSelect();
                displayOverallStatistics();
                displayProgressOverview();
                
            } catch (error) {
                console.error('Error loading progress data:', error);
                document.getElementById('progressOverview').innerHTML = 
                    `<div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem; color: #dc3545;">‚ö†Ô∏è</div>
                        <h3 style="margin-bottom: 1rem; color: #333;">Unable to Load Progress</h3>
                        <p style="color: #666; margin-bottom: 2rem;">There was an error loading your progress data. Please try refreshing the page.</p>
                        <button onclick="location.reload()" class="btn btn-primary">Refresh Page</button>
                    </div>`;
            }
        }

        // Populate course selection dropdown
        function populateCourseSelect() {
            const courseSelect = document.getElementById('courseSelect');
            
            // Clear existing options except the first one
            courseSelect.innerHTML = '<option value="">All Courses Overview</option>';
            
            allProgressData.forEach((course, index) => {
                const option = document.createElement('option');
                // Use array index as a more reliable identifier
                option.value = index.toString();
                option.textContent = course.courseName || 'Unknown Course';
                option.setAttribute('data-course-id', course.courseId || '');
                option.setAttribute('data-course-name', course.courseName || '');
                courseSelect.appendChild(option);
            });
            
            // Add event listener
            courseSelect.addEventListener('change', handleCourseSelection);
        }

        // Handle course selection
        function handleCourseSelection() {
            const courseSelect = document.getElementById('courseSelect');
            const selectedIndex = courseSelect.value;
            
            if (selectedIndex !== '' && selectedIndex !== undefined) {
                const index = parseInt(selectedIndex);
                if (index >= 0 && index < allProgressData.length) {
                    selectedCourse = allProgressData[index];
                    showDetailedProgress();
                } else {
                    selectedCourse = null;
                    showOverviewProgress();
                }
            } else {
                selectedCourse = null;
                showOverviewProgress();
            }
        }

        // Show overview progress
        function showOverviewProgress() {
            document.getElementById('overviewSection').style.display = 'block';
            document.getElementById('detailedSection').style.display = 'none';
            displayProgressOverview();
        }

        // Show detailed progress
        function showDetailedProgress() {
            document.getElementById('overviewSection').style.display = 'none';
            document.getElementById('detailedSection').style.display = 'block';
            displayDetailedProgress();
        }

        // Display overall statistics
        function displayOverallStatistics() {
            const totalCourses = allProgressData.length;
            
            // Count completed courses using multiple criteria
            const completedCourses = allProgressData.filter(course => {
                // Check if explicitly marked as completed
                if (course.isCompleted) return true;
                
                // Check if overall progress is 100%
                if (course.overallProgress >= 100) return true;
                
                // Check if all lessons are completed
                if (course.progress && course.progress.totalLessons && course.progress.completedLessons) {
                    return course.progress.completedLessons >= course.progress.totalLessons;
                }
                
                return false;
            }).length;
            
            // Count total quizzes across all courses
            const totalQuizzes = allProgressData.reduce((sum, course) => {
                return sum + (course.quizScores ? course.quizScores.length : 0);
            }, 0);
            
            // Calculate average score from all quizzes and final exams
            let totalScore = 0;
            let totalAssessments = 0;
            
            allProgressData.forEach(course => {
                // Add quiz scores
                if (course.quizScores && course.quizScores.length > 0) {
                    course.quizScores.forEach(quiz => {
                        if (quiz.percentage !== undefined && quiz.percentage !== null) {
                            totalScore += quiz.percentage;
                            totalAssessments++;
                        }
                    });
                }
                
                // Add final exam scores
                if (course.finalExamScore) {
                    const examPercentage = typeof course.finalExamScore === 'object' ? 
                                          course.finalExamScore.percentage : course.finalExamScore;
                    if (examPercentage !== undefined && examPercentage !== null) {
                        totalScore += examPercentage;
                        totalAssessments++;
                    }
                }
            });
            
            const averageScore = totalAssessments > 0 ? Math.round(totalScore / totalAssessments) : 0;

            // Animate numbers with improved display
            animateNumber('totalCourses', totalCourses);
            animateNumber('completedCourses', completedCourses);
            animateNumber('totalQuizzes', totalQuizzes);
            
            // Update average score with color coding
            const avgElement = document.getElementById('averageScore');
            avgElement.textContent = averageScore + '%';
            
            // Color code the average score
            if (averageScore >= 80) {
                avgElement.style.color = '#28a745'; // Green for excellent
            } else if (averageScore >= 60) {
                avgElement.style.color = '#ffc107'; // Yellow for good
            } else if (averageScore > 0) {
                avgElement.style.color = '#dc3545'; // Red for needs improvement
            } else {
                avgElement.style.color = '#6c757d'; // Gray for no data
            }
        }

        // Display progress overview
        function displayProgressOverview() {
            const container = document.getElementById('progressOverview');
            
            if (allProgressData.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üìö</div>
                        <h3 style="margin-bottom: 1rem; color: #333;">No Progress Data</h3>
                        <p style="color: #666; margin-bottom: 2rem;">Enroll in courses to start tracking your progress.</p>
                        <a href="courses.html" class="btn btn-primary">Browse Courses</a>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="course-grid">
                    ${allProgressData.map((course, index) => {
                        // Calculate progress based on multiple factors
                        let progressPercentage = course.overallProgress || 0;
                        
                        // If no overall progress, calculate from available data
                        if (!progressPercentage && course.progress) {
                            const completed = course.progress.completedLessons || 0;
                            const total = course.progress.totalLessons || 0;
                            if (total > 0) {
                                progressPercentage = Math.round((completed / total) * 100);
                            }
                        }
                        
                        // Quiz info
                        const quizCount = course.quizScores ? course.quizScores.length : 0;
                        
                        // Final exam info
                        let examInfo = 'Pending';
                        let examColor = '#dc3545';
                        if (course.finalExamScore) {
                            const examScore = typeof course.finalExamScore === 'object' ? 
                                             course.finalExamScore.percentage : course.finalExamScore;
                            examInfo = examScore + '%';
                            examColor = examScore >= 80 ? '#28a745' : examScore >= 60 ? '#ffc107' : '#dc3545';
                        } else if (course.finalExamTaken) {
                            examInfo = 'Completed';
                            examColor = '#28a745';
                        }
                        
                        // Course image
                        const defaultImage = "data:image/svg+xml," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='400' height='150' viewBox='0 0 400 150'><rect width='400' height='150' fill='#667eea'/><text x='200' y='75' text-anchor='middle' dy='0.35em' fill='white' font-size='16' font-family='Arial'>üìö ${course.courseName || 'Course'}</text></svg>`);
                        const courseImage = course.courseImage || defaultImage;
                        
                        return `
                        <div class="card">
                            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                               <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='150' viewBox='0 0 400 150'><rect width='400' height='150' fill='%23667eea'/><text x='200' y='75' text-anchor='middle' dy='0.35em' fill='white' font-size='16' font-family='Arial'>üìö Learnova</text></svg>" alt="${course.courseName || 'Course'}" 
                                     style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 1rem;">
                            </div>
                            
                            <h4 style="margin-bottom: 1rem; color: #333; font-size: 1.1rem;">${course.courseName || 'Unknown Course'}</h4>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="font-weight: 600;">Overall Progress</span>
                                    <span style="font-weight: bold; color: #667eea;">${progressPercentage}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div style="text-align: center; padding: 0.5rem; background: #f8f9fa; border-radius: 5px;">
                                    <div style="font-weight: bold; color: #667eea;">${quizCount}</div>
                                    <div style="color: #666;">Quizzes</div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: #f8f9fa; border-radius: 5px;">
                                    <div style="font-weight: bold; color: ${examColor};">${examInfo}</div>
                                    <div style="color: #666;">Final Exam</div>
                                </div>
                            </div>
                            
                            <button onclick="selectCourse('${course.courseId || course.courseName}')" class="btn btn-primary w-100">
                                View Details
                            </button>
                        </div>
                    `;
                    }).join('')}
                </div>
            `;
        }

        // Select course programmatically
        function selectCourse(courseIdentifier) {
            const courseSelect = document.getElementById('courseSelect');
            
            // Find the course by ID or name
            const courseIndex = allProgressData.findIndex(course => 
                (course.courseId && course.courseId.toString() === courseIdentifier) || 
                course.courseName === courseIdentifier
            );
            
            if (courseIndex >= 0) {
                courseSelect.value = courseIndex.toString();
                handleCourseSelection();
            } else {
                console.warn('Course not found:', courseIdentifier);
            }
        }

        // Display detailed progress
        function displayDetailedProgress() {
            if (!selectedCourse) return;
            
            // Calculate progress for the selected course
            let progressPercentage = selectedCourse.overallProgress || 0;
            if (!progressPercentage && selectedCourse.progress) {
                const completed = selectedCourse.progress.completedLessons || 0;
                const total = selectedCourse.progress.totalLessons || 0;
                if (total > 0) {
                    progressPercentage = Math.round((completed / total) * 100);
                }
            }
            
            // Course Progress Summary
            const defaultImage = "data:image/svg+xml," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='400' height='150' viewBox='0 0 400 150'><rect width='400' height='150' fill='#667eea'/><text x='200' y='75' text-anchor='middle' dy='0.35em' fill='white' font-size='16' font-family='Arial'>üìö ${selectedCourse.courseName || 'Course'}</text></svg>`);
            const courseImage = selectedCourse.courseImage || defaultImage;
            
            document.getElementById('courseProgressSummary').innerHTML = `
                <div class="card">
                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 2rem; align-items: center;">
                        <img src="${courseImage}" 
                             alt="${selectedCourse.courseName || 'Course'}" 
                             style="width: 120px; height: 80px; object-fit: cover; border-radius: 8px;">
                        <div>
                            <h3 style="margin-bottom: 0.5rem; color: #333;">${selectedCourse.courseName}</h3>
                            <p style="color: #666; margin-bottom: 1rem;">${selectedCourse.description || 'Course description not available'}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-weight: 600;">Overall Progress</span>
                                <span style="font-weight: bold; color: #667eea;">${progressPercentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            ${selectedCourse.isCompleted || progressPercentage >= 100 ? `
                                <div style="color: #28a745; font-size: 3rem; margin-bottom: 0.5rem;">üèÜ</div>
                                <div style="font-weight: bold; color: #28a745;">Completed!</div>
                            ` : `
                                <div style="color: #667eea; font-size: 3rem; margin-bottom: 0.5rem;">üìö</div>
                                <div style="font-weight: bold; color: #667eea;">In Progress</div>
                            `}
                        </div>
                    </div>
                </div>
            `;
            
            // Module Progress - Enhanced to show more details
            const moduleProgressContent = generateModuleProgressContent(selectedCourse, progressPercentage);
            document.getElementById('moduleProgress').innerHTML = moduleProgressContent;
            
            // Quiz Results - Enhanced display
            const quizResultsContent = generateQuizResultsContent(selectedCourse);
            document.getElementById('quizResults').innerHTML = quizResultsContent;
            
            // Final Exam Result - Enhanced display  
            const finalExamContent = generateFinalExamContent(selectedCourse);
            document.getElementById('finalExamResult').innerHTML = finalExamContent;
        }
        
        // Generate module progress content
        function generateModuleProgressContent(course, progressPercentage) {
            if (course.progress && (course.progress.totalLessons || course.progress.completedLessons)) {
                const completed = course.progress.completedLessons || 0;
                const total = course.progress.totalLessons || 0;
                
                return `
                    <div class="card">
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem; color: #667eea;">ÔøΩ</div>
                            <h4 style="margin-bottom: 1rem; color: #333;">Learning Progress</h4>
                            <div style="margin-bottom: 1.5rem;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">
                                    ${completed}/${total} Lessons
                                </div>
                                <div style="font-size: 1.2rem; color: #666; margin-bottom: 1rem;">
                                    ${progressPercentage}% Complete
                                </div>
                                <div class="progress-bar" style="max-width: 300px; margin: 0 auto;">
                                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                                </div>
                            </div>
                            ${total > 0 ? `
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 200px; margin: 0 auto;">
                                    <div style="text-align: center;">
                                        <div style="font-weight: bold; color: #28a745;">${completed}</div>
                                        <div style="font-size: 0.9rem; color: #666;">Completed</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-weight: bold; color: #dc3545;">${total - completed}</div>
                                        <div style="font-size: 0.9rem; color: #666;">Remaining</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="card">
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem; color: #667eea;">üìö</div>
                            <h4 style="margin-bottom: 1rem; color: #333;">Course Progress</h4>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">
                                    ${progressPercentage}% Complete
                                </div>
                                <div class="progress-bar" style="max-width: 300px; margin: 0 auto;">
                                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                                </div>
                            </div>
                            <p style="color: #666;">Detailed module progress is available when learning in the course.</p>
                            <a href="my-courses.html" class="btn btn-primary" style="margin-top: 1rem;">Go to My Courses</a>
                        </div>
                    </div>
                `;
            }
        }
        
        // Generate quiz results content
        function generateQuizResultsContent(course) {
            if (course.quizScores && course.quizScores.length > 0) {
                return `
                    <div class="card">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            ${course.quizScores.map((quiz, index) => `
                                <div style="padding: 1rem; border: 1px solid #e1e5e9; border-radius: 8px;">
                                    <h4 style="margin-bottom: 0.5rem; color: #333;">Quiz ${index + 1}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <span>Score:</span>
                                        <span style="font-weight: bold; color: ${getScoreColor(quiz.percentage || 0)};">
                                            ${quiz.score || 0}/${quiz.totalQuestions || 0} (${quiz.percentage || 0}%)
                                        </span>
                                    </div>
                                    <div class="progress-bar" style="height: 6px;">
                                        <div class="progress-fill" style="width: ${quiz.percentage || 0}%; background: ${getScoreColor(quiz.percentage || 0)};"></div>
                                    </div>
                                    ${quiz.completedAt ? `
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                                            Completed: ${new Date(quiz.completedAt).toLocaleDateString()}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="card text-center">
                        <div style="color: #666; padding: 2rem;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üìù</div>
                            <p>No quizzes taken yet. Complete modules to unlock quizzes.</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // Generate final exam content
        function generateFinalExamContent(course) {
            if (course.finalExamScore) {
                const examScore = typeof course.finalExamScore === 'object' ? course.finalExamScore : 
                                 { percentage: course.finalExamScore, score: 0, totalQuestions: 0 };
                                 
                return `
                    <div class="card">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <h4 style="margin-bottom: 0.5rem; color: #333;">Final Exam Result</h4>
                                <p style="color: #666; margin: 0;">Completed successfully</p>
                            </div>
                            <div style="text-align: right;">
                                ${examScore.score !== undefined && examScore.totalQuestions !== undefined ? `
                                    <div style="font-size: 1.5rem; font-weight: bold; color: ${getScoreColor(examScore.percentage)};">
                                        ${examScore.score}/${examScore.totalQuestions}
                                    </div>
                                ` : ''}
                                <div style="font-size: 1.2rem; font-weight: bold; color: ${getScoreColor(examScore.percentage)};">
                                    ${examScore.percentage}%
                                </div>
                            </div>
                        </div>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" style="width: ${examScore.percentage}%; background: ${getScoreColor(examScore.percentage)};"></div>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="card text-center">
                        <div style="color: #666; padding: 2rem;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üéØ</div>
                            <p>Final exam not taken yet. Complete all modules and quizzes first.</p>
                        </div>
                    </div>
                `;
            }
        }

        // Helper functions
        function getModuleStatusColor(status) {
            switch (status) {
                case 'completed': return '#28a745';
                case 'in-progress': return '#ffc107';
                default: return '#6c757d';
            }
        }

        function getModuleStatusText(status) {
            switch (status) {
                case 'completed': return 'Completed ‚úì';
                case 'in-progress': return 'In Progress';
                default: return 'Not Started';
            }
        }

        function getScoreColor(percentage) {
            if (percentage >= 80) return '#28a745';
            if (percentage >= 60) return '#ffc107';
            return '#dc3545';
        }

        // Animate number counting
        function animateNumber(elementId, targetNumber) {
            const element = document.getElementById(elementId);
            const duration = 1500;
            const steps = 30;
            const increment = targetNumber / steps;
            let current = 0;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= targetNumber) {
                    current = targetNumber;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, duration / steps);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            if (checkAuth()) {
                loadProgressData();
                
                // Check if specific course is requested
                const urlParams = new URLSearchParams(window.location.search);
                const requestedCourse = urlParams.get('course');
                if (requestedCourse) {
                    setTimeout(() => {
                        selectCourse(requestedCourse);
                    }, 1000);
                }
            }
        });
    </script>
    <script src="navbar.js"></script>
</body>
</html>

