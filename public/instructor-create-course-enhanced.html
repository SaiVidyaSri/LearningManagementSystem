<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Course - LearNova Instructor</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📚</text></svg>">
    <style>
        .instructor-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .instructor-card {
            border-left: 4px solid #667eea;
        }
        .form-wizard {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            position: relative;
        }
        .form-wizard::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e1e5e9;
            z-index: 1;
        }
        .wizard-step {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            position: relative;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s;
        }
        .wizard-step.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        .wizard-step.completed {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }
        .wizard-step-label {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-section h3 {
            margin-bottom: 1.5rem;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .required {
            color: #dc3545;
        }
        .form-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.25rem;
        }
        .image-preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            margin-top: 1rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .image-preview.has-image {
            border-style: solid;
            border-color: #667eea;
        }
        .module-item {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .lesson-item {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .add-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }
        .add-button:hover {
            background: #5a6fd8;
        }
        .remove-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #e1e5e9;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e1e5e9;
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        .course-preview {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .preview-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .preview-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        .preview-stat {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .preview-stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .preview-stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <header class="header instructor-nav">
        <div class="container">
            <nav class="nav">
                <a href="instructor-dashboard.html" class="logo"><img src="/path/to/your/logo.png" alt="LearNova Logo" style="height: 40px;"></a>
                <ul class="nav-links">
                    <li><a href="instructor-dashboard.html">Dashboard</a></li>
                    <li><a href="instructor-courses.html">My Courses</a></li>
                    <li><a href="instructor-create-course.html" class="active">Create Course</a></li>
                    <li><a href="instructor-students.html">Students</a></li>
                    <li><a href="instructor-queries.html">Q&A</a></li>
                </ul>
                <div class="user-info">
                    <span id="userWelcome">Welcome!</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <section style="margin-bottom: 3rem;">
                <div class="card instructor-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h1 style="margin-bottom: 1rem;">Create New Course ✨</h1>
                    <p style="opacity: 0.9; font-size: 1.1rem;">Build an engaging course to share your expertise with students worldwide.</p>
                </div>
            </section>

            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%;"></div>
            </div>

            <!-- Form Wizard -->
            <div class="form-wizard">
                <div class="wizard-step active" data-step="1">
                    1
                    <div class="wizard-step-label">Basic Info</div>
                </div>
                <div class="wizard-step" data-step="2">
                    2
                    <div class="wizard-step-label">Details</div>
                </div>
                <div class="wizard-step" data-step="3">
                    3
                    <div class="wizard-step-label">Content</div>
                </div>
                <div class="wizard-step" data-step="4">
                    4
                    <div class="wizard-step-label">Pricing</div>
                </div>
                <div class="wizard-step" data-step="5">
                    5
                    <div class="wizard-step-label">Review</div>
                </div>
            </div>

            <form id="createCourseForm">
                <!-- Step 1: Basic Information -->
                <div class="form-step active" data-step="1">
                    <div class="form-section">
                        <h3>📝 Basic Course Information</h3>
                        <div class="form-group">
                            <label for="courseName">Course Title <span class="required">*</span></label>
                            <input type="text" id="courseName" required placeholder="e.g., Complete Web Development Bootcamp">
                            <div class="form-help">Choose a clear, descriptive title that tells students what they'll learn</div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="courseCategory">Category <span class="required">*</span></label>
                                <select id="courseCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="programming">Programming & Development</option>
                                    <option value="design">Design & Creative</option>
                                    <option value="business">Business & Entrepreneurship</option>
                                    <option value="marketing">Marketing & Sales</option>
                                    <option value="photography">Photography & Video</option>
                                    <option value="music">Music & Audio</option>
                                    <option value="health">Health & Fitness</option>
                                    <option value="language">Language Learning</option>
                                    <option value="personal">Personal Development</option>
                                    <option value="academic">Academic</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="courseLevel">Difficulty Level <span class="required">*</span></label>
                                <select id="courseLevel" required>
                                    <option value="">Select Level</option>
                                    <option value="beginner">Beginner - No prior experience needed</option>
                                    <option value="intermediate">Intermediate - Some experience required</option>
                                    <option value="advanced">Advanced - Extensive experience required</option>
                                    <option value="all">All Levels - Suitable for everyone</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="courseDescription">Course Description <span class="required">*</span></label>
                            <textarea id="courseDescription" rows="4" required placeholder="Describe what students will learn, what problems this course solves, and why they should take it..."></textarea>
                            <div class="form-help">Write a compelling description that highlights the value and outcomes of your course</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Course Details -->
                <div class="form-step" data-step="2">
                    <div class="form-section">
                        <h3>🎯 Course Details & Outcomes</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="courseDuration">Estimated Duration (hours)</label>
                                <input type="number" id="courseDuration" min="1" max="200" placeholder="e.g., 15">
                                <div class="form-help">Total time students need to complete the course</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="courseLanguage">Course Language</label>
                                <select id="courseLanguage">
                                    <option value="english">English</option>
                                    <option value="spanish">Spanish</option>
                                    <option value="french">French</option>
                                    <option value="german">German</option>
                                    <option value="chinese">Chinese</option>
                                    <option value="japanese">Japanese</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="learningOutcomes">Learning Outcomes <span class="required">*</span></label>
                            <textarea id="learningOutcomes" rows="4" required placeholder="What will students be able to do after completing this course? List specific skills and knowledge they'll gain (one per line)"></textarea>
                            <div class="form-help">Be specific about what students will achieve. Use action verbs like "build", "create", "analyze", "implement"</div>
                        </div>

                        <div class="form-group">
                            <label for="prerequisites">Prerequisites & Requirements</label>
                            <textarea id="prerequisites" rows="3" placeholder="What should students know or have before taking this course? List any required software, tools, or prior knowledge"></textarea>
                            <div class="form-help">Help students understand if this course is right for them</div>
                        </div>

                        <div class="form-group">
                            <label for="targetAudience">Target Audience</label>
                            <textarea id="targetAudience" rows="2" placeholder="Who is this course designed for? Describe your ideal student"></textarea>
                            <div class="form-help">Help students identify if this course matches their goals</div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Course Content -->
                <div class="form-step" data-step="3">
                    <div class="form-section">
                        <h3>📚 Course Content Structure</h3>
                        
                        <div class="form-group">
                            <label for="courseImage">Course Thumbnail Image</label>
                            <input type="url" id="courseImage" placeholder="https://example.com/course-image.jpg" onchange="previewImage()">
                            <div class="form-help">Upload an eye-catching image that represents your course (recommended: 1280x720px)</div>
                            <div id="imagePreview" class="image-preview">
                                📷 Image Preview
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Course Modules & Lessons</label>
                            <div class="form-help" style="margin-bottom: 1rem;">Organize your course content into modules and lessons. Each module should cover a specific topic.</div>
                            
                            <div id="modulesContainer">
                                <!-- Modules will be added here dynamically -->
                            </div>
                            
                            <button type="button" class="add-button" onclick="addModule()">
                                ➕ Add Module
                            </button>
                        </div>

                        <div class="form-group">
                            <label for="courseResources">Additional Resources</label>
                            <textarea id="courseResources" rows="3" placeholder="List any additional resources, downloads, or materials students will receive (one per line)"></textarea>
                            <div class="form-help">Include worksheets, templates, source code, or reference materials</div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Pricing & Publishing -->
                <div class="form-step" data-step="4">
                    <div class="form-section">
                        <h3>💰 Pricing & Publishing Options</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="coursePrice">Course Price ($)</label>
                                <input type="number" id="coursePrice" min="0" step="0.01" placeholder="0.00">
                                <div class="form-help">Set to $0 for a free course. Consider your course value and market rates</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="courseStatus">Publishing Status</label>
                                <select id="courseStatus">
                                    <option value="draft">Draft - Save for later editing</option>
                                    <option value="published">Published - Make available to students</option>
                                </select>
                                <div class="form-help">You can always change this later</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="promotionalVideo">Promotional Video URL (Optional)</label>
                            <input type="url" id="promotionalVideo" placeholder="https://youtube.com/watch?v=...">
                            <div class="form-help">Add a short preview video to showcase your course</div>
                        </div>

                        <div class="form-group">
                            <label for="courseTags">Course Tags</label>
                            <input type="text" id="courseTags" placeholder="javascript, web development, programming, beginner">
                            <div class="form-help">Add relevant keywords separated by commas to help students find your course</div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Review & Submit -->
                <div class="form-step" data-step="5">
                    <div class="form-section">
                        <h3>👀 Course Preview & Final Review</h3>
                        
                        <div class="course-preview" id="coursePreview">
                            <!-- Course preview will be generated here -->
                        </div>
                        
                        <div style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 8px; padding: 1.5rem; margin-top: 2rem;">
                            <h4 style="margin-bottom: 1rem; color: #0066cc;">📋 Before You Submit</h4>
                            <ul style="color: #0066cc; line-height: 1.6;">
                                <li>Review all course information for accuracy</li>
                                <li>Ensure your course image and content are high quality</li>
                                <li>Check that learning outcomes are clear and achievable</li>
                                <li>Verify pricing and publishing status</li>
                                <li>Make sure your course provides real value to students</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="step-navigation">
                    <button type="button" id="prevBtn" onclick="changeStep(-1)" class="btn btn-outline" style="display: none;">
                        ← Previous
                    </button>
                    
                    <div style="display: flex; gap: 1rem;">
                        <button type="button" onclick="saveDraft()" class="btn btn-outline" id="saveDraftBtn">
                            💾 Save Draft
                        </button>
                        <button type="button" id="nextBtn" onclick="changeStep(1)" class="btn btn-primary">
                            Next →
                        </button>
                        <button type="submit" id="submitBtn" class="btn btn-primary" style="display: none;">
                            🚀 Create Course
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <footer style="background: #333; color: white; padding: 2rem 0; text-align: center; margin-top: 4rem;">
        <div class="container">
            <p>&copy; 2025 LearNova. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentUser = null;
        let currentStep = 1;
        let totalSteps = 5;
        let courseModules = [];

        // Check authentication and instructor status
        function checkAuth() {
            const user = localStorage.getItem('user');
            const token = localStorage.getItem('token');
            
            if (!user || !token) {
                window.location.href = 'login.html';
                return null;
            }
            
            currentUser = JSON.parse(user);
            
            if (currentUser.role !== 'instructor') {
                showAlert('Access denied. Instructor privileges required.', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return null;
            }
            
            document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.fullName || currentUser.username}!`;
            return currentUser;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        }

        // Change form step
        function changeStep(direction) {
            const newStep = currentStep + direction;
            
            if (newStep < 1 || newStep > totalSteps) return;
            
            // Validate current step before proceeding
            if (direction > 0 && !validateStep(currentStep)) {
                return;
            }
            
            // Hide current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.wizard-step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.wizard-step[data-step="${currentStep}"]`).classList.add('completed');
            
            // Show new step
            currentStep = newStep;
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.wizard-step[data-step="${currentStep}"]`).classList.add('active');
            
            // Update navigation buttons
            updateNavigation();
            
            // Update progress bar
            updateProgress();
            
            // Generate preview if on last step
            if (currentStep === totalSteps) {
                generateCoursePreview();
            }
        }

        // Validate current step
        function validateStep(step) {
            switch (step) {
                case 1:
                    const name = document.getElementById('courseName').value.trim();
                    const category = document.getElementById('courseCategory').value;
                    const level = document.getElementById('courseLevel').value;
                    const description = document.getElementById('courseDescription').value.trim();
                    
                    if (!name || !category || !level || !description) {
                        showAlert('Please fill in all required fields in Basic Information.', 'error');
                        return false;
                    }
                    if (description.length < 50) {
                        showAlert('Course description should be at least 50 characters long.', 'error');
                        return false;
                    }
                    break;
                    
                case 2:
                    const outcomes = document.getElementById('learningOutcomes').value.trim();
                    if (!outcomes) {
                        showAlert('Please specify learning outcomes for your course.', 'error');
                        return false;
                    }
                    break;
                    
                case 3:
                    // Content validation is optional but we can check for modules
                    break;
                    
                case 4:
                    // Pricing validation
                    const price = document.getElementById('coursePrice').value;
                    if (price && (isNaN(price) || parseFloat(price) < 0)) {
                        showAlert('Please enter a valid price.', 'error');
                        return false;
                    }
                    break;
            }
            return true;
        }

        // Update navigation buttons
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.style.display = currentStep === 1 ? 'none' : 'block';
            
            if (currentStep === totalSteps) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            }
        }

        // Update progress bar
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // Preview course image
        function previewImage() {
            const imageUrl = document.getElementById('courseImage').value;
            const preview = document.getElementById('imagePreview');
            
            if (imageUrl) {
                preview.style.backgroundImage = `url(${imageUrl})`;
                preview.classList.add('has-image');
                preview.textContent = '';
            } else {
                preview.style.backgroundImage = '';
                preview.classList.remove('has-image');
                preview.textContent = '📷 Image Preview';
            }
        }

        // Add new module
        function addModule() {
            const moduleId = Date.now();
            const moduleHtml = `
                <div class="module-item" data-module-id="${moduleId}">
                    <div class="module-header">
                        <input type="text" placeholder="Module Title" class="module-title" style="flex: 1; margin-right: 1rem; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        <button type="button" class="remove-button" onclick="removeModule(${moduleId})">Remove</button>
                    </div>
                    <div class="lessons-container" data-module-id="${moduleId}">
                        <!-- Lessons will be added here -->
                    </div>
                    <button type="button" class="add-button" onclick="addLesson(${moduleId})" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">
                        ➕ Add Lesson
                    </button>
                </div>
            `;
            
            document.getElementById('modulesContainer').insertAdjacentHTML('beforeend', moduleHtml);
        }

        // Remove module
        function removeModule(moduleId) {
            document.querySelector(`[data-module-id="${moduleId}"]`).remove();
        }

        // Add lesson to module
        function addLesson(moduleId) {
            const lessonId = Date.now();
            const lessonHtml = `
                <div class="lesson-item" data-lesson-id="${lessonId}">
                    <input type="text" placeholder="Lesson Title" class="lesson-title" style="flex: 1; margin-right: 1rem; padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                    <button type="button" class="remove-button" onclick="removeLesson(${lessonId})" style="font-size: 0.7rem; padding: 0.125rem 0.25rem;">×</button>
                </div>
            `;
            
            document.querySelector(`.lessons-container[data-module-id="${moduleId}"]`).insertAdjacentHTML('beforeend', lessonHtml);
        }

        // Remove lesson
        function removeLesson(lessonId) {
            document.querySelector(`[data-lesson-id="${lessonId}"]`).remove();
        }

        // Generate course preview
        function generateCoursePreview() {
            const preview = document.getElementById('coursePreview');
            const formData = collectFormData();
            
            const moduleCount = document.querySelectorAll('.module-item').length;
            const lessonCount = document.querySelectorAll('.lesson-item').length;
            
            preview.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <img src="${formData.image || 'data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" viewBox=\\"0 0 300 200\\"><rect width=\\"300\\" height=\\"200\\" fill=\\"%23f0f0f0\\"/><text x=\\"150\\" y=\\"100\\" text-anchor=\\"middle\\" fill=\\"%23999\\" font-size=\\"16\\">Course Image</text></svg>'}" 
                         alt="Course Preview" class="preview-image">
                </div>
                
                <h3 style="margin-bottom: 1rem; color: #333;">${formData.name}</h3>
                
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <span style="background: #667eea; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                        ${formData.category}
                    </span>
                    <span style="background: #28a745; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                        ${formData.level}
                    </span>
                    <span style="background: #ffc107; color: #333; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                        ${formData.price > 0 ? `$${formData.price}` : 'Free'}
                    </span>
                </div>
                
                <p style="color: #666; margin-bottom: 2rem; line-height: 1.6;">${formData.description}</p>
                
                <div class="preview-stats">
                    <div class="preview-stat">
                        <div class="preview-stat-number">${moduleCount}</div>
                        <div class="preview-stat-label">Modules</div>
                    </div>
                    <div class="preview-stat">
                        <div class="preview-stat-number">${lessonCount}</div>
                        <div class="preview-stat-label">Lessons</div>
                    </div>
                    <div class="preview-stat">
                        <div class="preview-stat-number">${formData.duration || 0}h</div>
                        <div class="preview-stat-label">Duration</div>
                    </div>
                </div>
                
                ${formData.learningOutcomes ? `
                    <div style="margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: #333;">What You'll Learn:</h4>
                        <ul style="color: #666; line-height: 1.6;">
                            ${formData.learningOutcomes.split('\n').filter(outcome => outcome.trim()).map(outcome => `<li>${outcome.trim()}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
            `;
        }

        // Collect form data
        function collectFormData() {
            // Collect modules and lessons
            const modules = [];
            document.querySelectorAll('.module-item').forEach(moduleEl => {
                const moduleTitle = moduleEl.querySelector('.module-title').value.trim();
                if (moduleTitle) {
                    const lessons = [];
                    moduleEl.querySelectorAll('.lesson-item').forEach(lessonEl => {
                        const lessonTitle = lessonEl.querySelector('.lesson-title').value.trim();
                        if (lessonTitle) {
                            lessons.push({
                                title: lessonTitle,
                                duration: 0,
                                videoUrl: '',
                                content: ''
                            });
                        }
                    });
                    
                    modules.push({
                        title: moduleTitle,
                        description: '',
                        lessons: lessons
                    });
                }
            });

            return {
                name: document.getElementById('courseName').value.trim(),
                description: document.getElementById('courseDescription').value.trim(),
                shortDescription: document.getElementById('courseDescription').value.trim().substring(0, 150) + '...',
                category: document.getElementById('courseCategory').value,
                level: document.getElementById('courseLevel').value,
                duration: parseInt(document.getElementById('courseDuration').value) || 0,
                language: document.getElementById('courseLanguage').value,
                price: parseFloat(document.getElementById('coursePrice').value) || 0,
                image: document.getElementById('courseImage').value.trim(),
                learningOutcomes: document.getElementById('learningOutcomes').value.trim().split('\n').filter(outcome => outcome.trim()),
                prerequisites: document.getElementById('prerequisites').value.trim(),
                targetAudience: document.getElementById('targetAudience').value.trim(),
                resources: document.getElementById('courseResources').value.trim().split('\n').filter(resource => resource.trim()),
                promotionalVideo: document.getElementById('promotionalVideo').value.trim(),
                tags: document.getElementById('courseTags').value.trim().split(',').map(tag => tag.trim()).filter(tag => tag),
                status: document.getElementById('courseStatus').value,
                modules: modules,
                instructorName: currentUser.fullName || currentUser.username
            };
        }

        // Save as draft
        async function saveDraft() {
            const formData = collectFormData();
            formData.status = 'draft';
            await submitCourse(formData);
        }

        // Handle form submission
        document.getElementById('createCourseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateStep(currentStep)) return;
            
            const formData = collectFormData();
            await submitCourse(formData);
        });

        // Submit course
        async function submitCourse(formData) {
            try {
                const response = await fetch('/api/courses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error('Failed to create course');
                }

                const result = await response.json();
                
                showAlert(`Course ${formData.status === 'draft' ? 'saved as draft' : 'created and published'} successfully!`, 'success');
                
                setTimeout(() => {
                    window.location.href = 'instructor-courses.html';
                }, 2000);

            } catch (error) {
                console.error('Error creating course:', error);
                showAlert('Failed to create course. Please try again.', 'error');
            }
        }

        // Show alert message
        function showAlert(message, type = 'error') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type === 'success' ? 'alert-success' : 'alert-error'}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.maxWidth = '400px';
            alertDiv.style.padding = '1rem';
            alertDiv.style.borderRadius = '8px';
            alertDiv.style.color = 'white';
            alertDiv.style.background = type === 'success' ? '#28a745' : '#dc3545';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            if (checkAuth()) {
                updateNavigation();
                updateProgress();
                
                // Add initial module
                addModule();
            }
        });
    </script>
</body>
</html>

