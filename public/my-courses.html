<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Courses - LearNova</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="navbar.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📚</text></svg>">
    <style>
        .alert {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            border: none;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0;
        }
        
        .modal-header h2 {
            margin: 0;
            color: white;
        }
        
        .modal-body {
            padding: 2rem;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover,
        .close:focus {
            color: #f1f1f1;
        }
        
        .course-detail-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .course-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .course-detail-stats {
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .course-detail-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        
        .level-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .level-beginner { background: #d4edda; color: #155724; }
        .level-intermediate { background: #fff3cd; color: #856404; }
        .level-advanced { background: #f8d7da; color: #721c24; }
        .notification-dot {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            border: 2px solid white;
        }
    </style>
</head>
<body>
    <!-- Navbar will be inserted here by navbar.js -->

    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <section style="margin-bottom: 3rem;">
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h1 style="margin-bottom: 1rem;">My Learning Journey 📚</h1>
                    <p style="opacity: 0.9; font-size: 1.1rem;">Track your progress and continue learning at your own pace.</p>
                </div>
            </section>

            <!-- Learning Statistics -->
            <section style="margin-bottom: 3rem;">
                <h2 style="margin-bottom: 2rem; color: #333;">Learning Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="enrolledCount">0</div>
                        <div class="stat-label">Enrolled Courses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedCount">0</div>
                        <div class="stat-label">Completed Courses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averageProgress">0%</div>
                        <div class="stat-label">Average Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuizzes">0</div>
                        <div class="stat-label">Quizzes Completed</div>
                    </div>
                </div>
            </section>

            <!-- Filter and Sort -->
            <section style="margin-bottom: 2rem;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <label for="statusFilter" style="font-weight: 600;">Filter by Status:</label>
                            <select id="statusFilter" class="form-control" style="width: auto;">
                                <option value="all">All Courses</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="not-started">Not Started</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <label for="sortBy" style="font-weight: 600;">Sort by:</label>
                            <select id="sortBy" class="form-control" style="width: auto;">
                                <option value="progress">Progress</option>
                                <option value="name">Course Name</option>
                                <option value="enrolled">Enrollment Date</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- My Courses -->
            <section>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="color: #333;">My Courses</h2>
                    <a href="courses.html" class="btn btn-outline">Browse More Courses</a>
                </div>
                
                <div id="myCoursesContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- No Courses Message -->
                <div id="noCoursesMessage" style="display: none; text-align: center; padding: 4rem 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">📚</div>
                    <h3 style="margin-bottom: 1rem; color: #333;">No Courses Yet</h3>
                    <p style="color: #666; margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                        You haven't enrolled in any courses yet. Start your learning journey by exploring our course catalog.
                    </p>
                    <a href="courses.html" class="btn btn-primary">Explore Courses</a>
                </div>
            </section>
        </div>
    </main>

    <!-- Course Details Modal -->
    <div id="courseModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 id="modalCourseTitle">Course Details</h2>
                <span class="close" onclick="closeCourseModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalCourseContent">
                    <!-- Course details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <footer style="background: #333; color: white; padding: 2rem 0; text-align: center; margin-top: 4rem;">
        <div class="container">
            <p>&copy; 2025 LearNova. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentUser = null;
        let allCourses = [];
        let filteredCourses = [];

        // Check authentication
        function checkAuth() {
            // Check both 'user' and 'userData' for compatibility
            const user = localStorage.getItem('userData') || localStorage.getItem('user');
            if (!user) {
                window.location.href = 'login.html';
                return null;
            }
            
            currentUser = JSON.parse(user);
            console.log('✅ User authenticated:', currentUser.fullName || currentUser.username || 'Student');
            return currentUser;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = 'student-dashboard.html';
        }

        // Load user's courses
        async function loadMyCourses() {
            if (!currentUser) {
                console.log('❌ No current user found');
                return;
            }

            console.log('🔄 Loading courses for user:', currentUser.fullName);
            
            try {
                // First refresh progress for all courses
                try {
                    await fetch('/api/refresh-progress', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    console.log('Progress refreshed before loading courses');
                } catch (refreshError) {
                    console.log('Progress refresh failed, continuing with course load:', refreshError);
                }

                console.log('📡 Fetching student progress details...');
                const response = await fetch('/api/student-progress-details', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                console.log('📡 Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch courses: ${response.status} ${response.statusText}`);
                }
                
                const progressDetails = await response.json();
                console.log('📊 Received progress details:', progressDetails);
                
                // Transform the progress details to match the expected format
                allCourses = progressDetails
                    .filter(progress => progress.courseId) // Filter out null courses
                    .map(progress => ({
                        courseId: progress.courseId,
                        courseName: progress.courseName || 'Unknown Course',
                        courseDescription: progress.description || 'No description available',
                        enrolledAt: progress.enrolledAt,
                        progress: {
                            overallProgress: progress.overallProgress || 0,
                            completedLessons: 0, // Will be calculated from overallProgress
                            totalLessons: 0
                        },
                        overallProgress: progress.overallProgress || 0,
                        completedModules: 0,
                        totalModules: 0,
                        completedLessons: 0,
                        totalLessons: 0,
                        quizScores: progress.quizScores || [],
                        finalExamScore: progress.finalExamScore,
                        isCompleted: progress.isCompleted || false,
                        certificateIssued: progress.certificateIssued || false,
                        certificateIssuedAt: progress.certificateIssuedAt,
                        status: progress.status,
                        completedAt: progress.completedAt,
                        instructorName: progress.instructorName || 'Unknown Instructor',
                        category: progress.category || '',
                        level: progress.level || '',
                        estimatedHours: progress.estimatedHours || 0
                }));
                
                console.log('✅ Loaded courses:', allCourses.length);
                console.log('📚 Course details:', allCourses);
                
                filteredCourses = [...allCourses];
                
                displayCourses();
                updateStatistics();
                
            } catch (error) {
                console.error('❌ Error loading courses:', error);
                console.error('Error details:', error.message);
                document.getElementById('myCoursesContainer').innerHTML = 
                    `<div style="text-align: center; padding: 2rem; color: #666;">
                        <h3>Unable to load your courses</h3>
                        <p>Error: ${error.message}</p>
                        <p>Please check the browser console for more details and try refreshing the page.</p>
                        <button onclick="loadMyCourses()" style="background: #667eea; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">Try Again</button>
                    </div>`;
            }
        }

        // Display courses
        function displayCourses() {
            console.log('🎨 Displaying courses:', filteredCourses.length);
            const container = document.getElementById('myCoursesContainer');
            const noCoursesMessage = document.getElementById('noCoursesMessage');
            
            if (!container) {
                console.error('❌ Container element not found');
                return;
            }
            
            if (filteredCourses.length === 0) {
                console.log('📭 No courses to display');
                container.innerHTML = '';
                if (noCoursesMessage) noCoursesMessage.style.display = allCourses.length === 0 ? 'block' : 'none';
                return;
            }
            
            if (noCoursesMessage) noCoursesMessage.style.display = 'none';
            
            container.innerHTML = `
                <div class="course-grid">
                    ${filteredCourses.map(course => `
                        <div class="course-card fade-in">
                            <div class="course-content">
                                <div style="text-align: center; font-size: 3rem; margin-bottom: 1rem;">📚</div>
                                <h3 class="course-title" style="text-align: center; margin-bottom: 0.5rem;">${course.courseName}</h3>
                                <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 1rem;">by ${course.instructorName || 'Unknown Instructor'}</p>
                                <p class="course-description" style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">${course.courseDescription}</p>
                                
                                <!-- Progress Bar -->
                                <div style="margin: 1rem 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <span style="font-weight: 600; color: #333;">Progress</span>
                                        <span style="font-weight: bold; color: #667eea;">${course.overallProgress}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${course.overallProgress}%"></div>
                                    </div>
                                </div>
                                
                                <!-- Course Stats -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin: 1rem 0; font-size: 0.9rem; color: #666;">
                                    <div>📖 ${course.completedModules}/${course.totalModules} modules</div>
                                    <div>📝 ${course.quizScores.length} quizzes</div>
                                    <div>🏆 ${course.finalExamScore ? 'Exam completed' : 'Exam pending'}</div>
                                    <div>✅ ${course.isCompleted ? 'Completed' : 'In progress'}</div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                    ${(() => {
                                        const hasStarted = course.overallProgress > 0;
                                        const isCompleted = course.isCompleted;
                                        
                                        let buttonText = '🚀 Start Now';
                                        let buttonAction = `startCourse('${course.courseName}')`;
                                        
                                        if (course.certificateIssued) {
                                            buttonText = '🎓 Access Course';
                                            buttonAction = `window.location.href='course-learn.html?course=${encodeURIComponent(course.courseName)}'`;
                                        } else if (isCompleted) {
                                            buttonText = '🎓 Access Course';
                                            buttonAction = `window.location.href='course-learn.html?course=${encodeURIComponent(course.courseName)}'`;
                                        } else if (hasStarted) {
                                            buttonText = '📖 Continue';
                                            buttonAction = `window.location.href='course-learn.html?course=${encodeURIComponent(course.courseName)}'`;
                                        } else {
                                            buttonAction = `window.location.href='course-learn.html?course=${encodeURIComponent(course.courseName)}'`;
                                        }
                                        
                                        return `<button onclick="${buttonAction}" class="btn btn-primary" style="flex: 1;">${buttonText}</button>`;
                                    })()}
                                    <button onclick="showCourseDetails('${course.courseId}')" 
                                       class="btn btn-outline" style="flex: 1;">ℹ️ Details</button>
                                </div>
                                
                                ${course.isCompleted ? `
                                    <div style="text-align: center; margin-top: 1rem; padding: 0.75rem; background: linear-gradient(135deg, #d4edda, #c3e6cb); border-radius: 8px; color: #155724; border: 1px solid #c3e6cb;">
                                        🎉 Course Completed! Well done!
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Update statistics
        function updateStatistics() {
            const enrolledCount = allCourses.length;
            const completedCount = allCourses.filter(course => course.isCompleted).length;
            const totalProgress = allCourses.reduce((sum, course) => sum + course.overallProgress, 0);
            const averageProgress = enrolledCount > 0 ? Math.round(totalProgress / enrolledCount) : 0;
            const totalQuizzes = allCourses.reduce((sum, course) => sum + course.quizScores.length, 0);

            // Animate numbers
            animateNumber('enrolledCount', enrolledCount);
            animateNumber('completedCount', completedCount);
            animateNumber('totalQuizzes', totalQuizzes);
            
            // Update average progress
            document.getElementById('averageProgress').textContent = averageProgress + '%';
        }

        // Filter courses
        function filterCourses() {
            const statusFilter = document.getElementById('statusFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            // Filter by status
            if (statusFilter === 'all') {
                filteredCourses = [...allCourses];
            } else if (statusFilter === 'completed') {
                filteredCourses = allCourses.filter(course => course.isCompleted);
            } else if (statusFilter === 'in-progress') {
                filteredCourses = allCourses.filter(course => !course.isCompleted && course.overallProgress > 0);
            } else if (statusFilter === 'not-started') {
                filteredCourses = allCourses.filter(course => course.overallProgress === 0);
            }
            
            // Sort courses
            filteredCourses.sort((a, b) => {
                switch (sortBy) {
                    case 'progress':
                        return b.overallProgress - a.overallProgress;
                    case 'name':
                        return a.courseName.localeCompare(b.courseName);
                    case 'enrolled':
                        return new Date(b.enrolledAt) - new Date(a.enrolledAt);
                    default:
                        return 0;
                }
            });
            
            displayCourses();
        }

        // Animate number counting
        function animateNumber(elementId, targetNumber) {
            const element = document.getElementById(elementId);
            const duration = 1500;
            const steps = 30;
            const increment = targetNumber / steps;
            let current = 0;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= targetNumber) {
                    current = targetNumber;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, duration / steps);
        }

        // Start course function
        async function startCourse(courseName) {
            try {
                const token = localStorage.getItem('token');
                
                // Mark course as started
                const startResponse = await fetch(`/api/courses/${encodeURIComponent(courseName)}/start`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!startResponse.ok) {
                    const errorText = await startResponse.text();
                    throw new Error(`Failed to start course: ${errorText}`);
                }

                const result = await startResponse.json();
                console.log('Course started:', result);

                // Show success message
                showAlert('Course started successfully! 🚀', 'success');
                
                // Refresh the courses to update the UI immediately
                await loadMyCourses();
                
                // Navigate to the course learning page after a brief delay
                setTimeout(() => {
                    window.location.href = `course-learn.html?course=${encodeURIComponent(courseName)}`;
                }, 2000);
                
            } catch (error) {
                console.error('Error starting course:', error);
                showAlert(`Failed to start course: ${error.message}`, 'error');
            }
        }

        // Show alert message
        function showAlert(message, type = 'error') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type === 'success' ? 'alert-success' : 'alert-error'}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.maxWidth = '400px';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Show course details in modal
        async function showCourseDetails(courseId) {
            try {
                // Find course in local data first
                const course = allCourses.find(c => c.courseId === courseId);
                if (!course) {
                    showAlert('Course not found', 'error');
                    return;
                }

                // Fetch detailed course information
                const response = await fetch(`/api/courses/${courseId}`);
                let detailedCourse = null;
                
                if (response.ok) {
                    detailedCourse = await response.json();
                } else {
                    console.warn('Could not fetch detailed course info, using cached data');
                    // Create a mock detailed course from the available data
                    detailedCourse = {
                        _id: course.courseId,
                        name: course.courseName,
                        description: course.courseDescription,
                        image: course.courseImage,
                        level: 'Intermediate', // Default level
                        category: 'General', // Default category
                        price: 0, // Default to free
                        averageRating: 4.5,
                        enrollmentCount: 100,
                        estimatedHours: 10,
                        instructorName: 'Instructor'
                    };
                }

                // Populate modal with course details
                document.getElementById('modalCourseTitle').textContent = detailedCourse.name;
                
                const modalContent = document.getElementById('modalCourseContent');
                modalContent.innerHTML = `
                    <div style="text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 2rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-size: 4rem; margin-bottom: 0.5rem;">📚</div>
                        <h3 style="margin: 0; color: white;">LearNova Course</h3>
                    </div>
                    
                    <div class="course-detail-meta">
                        <span class="level-badge level-${(detailedCourse.level || 'intermediate').toLowerCase()}">${detailedCourse.level || 'Intermediate'}</span>
                        <span style="color: #666;">${detailedCourse.category || 'General'}</span>
                        <span style="color: #667eea; font-weight: bold;">${detailedCourse.price === 0 ? 'Free' : `$${detailedCourse.price || 0}`}</span>
                    </div>
                    
                    <div class="course-detail-stats">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #667eea;">⭐ ${(detailedCourse.averageRating || 4.5).toFixed(1)}</div>
                            <div style="font-size: 0.9rem; color: #666;">Rating</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #667eea;">👥 ${detailedCourse.enrollmentCount || 100}</div>
                            <div style="font-size: 0.9rem; color: #666;">Students</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #667eea;">🕒 ${detailedCourse.estimatedHours || 10}h</div>
                            <div style="font-size: 0.9rem; color: #666;">Duration</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: #333; margin-bottom: 0.5rem;">Instructor</h4>
                        <p style="color: #666;">${detailedCourse.instructorName || detailedCourse.instructor?.fullName || 'Instructor'}</p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: #333; margin-bottom: 0.5rem;">Description</h4>
                        <p style="color: #666; line-height: 1.6;">${detailedCourse.description || course.courseDescription || 'No description available.'}</p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: #333; margin-bottom: 0.5rem;">Your Progress</h4>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Overall Progress:</span>
                                <span style="font-weight: bold; color: #667eea;">${course.overallProgress}%</span>
                            </div>
                            <div style="width: 100%; background-color: #e0e0e0; border-radius: 10px; height: 10px;">
                                <div style="width: ${course.overallProgress}%; background: linear-gradient(45deg, #667eea, #764ba2); height: 100%; border-radius: 10px; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
                                <span>Modules: ${course.completedModules}/${course.totalModules}</span>
                                <span>Lessons: ${course.completedLessons}/${course.totalLessons}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${course.quizScores && course.quizScores.length > 0 ? `
                        <div style="margin-bottom: 1rem;">
                            <h4 style="color: #333; margin-bottom: 0.5rem;">Quiz Scores</h4>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                                <p style="color: #666; margin: 0;">Completed ${course.quizScores.length} quizzes</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="course-detail-actions">
                        ${course.isCompleted ? 
                            `<span class="btn btn-success" style="flex: 1; text-align: center;">✅ Course Completed</span>` :
                            `<button onclick="continueOrStartCourse('${course.courseName}')" class="btn btn-primary" style="flex: 1;">${course.overallProgress > 0 ? '📖 Continue Learning' : '🚀 Start Course'}</button>`
                        }
                        <button onclick="closeCourseModal()" class="btn btn-outline" style="flex: 1;">❌ Close</button>
                    </div>
                `;

                // Show modal
                document.getElementById('courseModal').style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling

            } catch (error) {
                console.error('Error loading course details:', error);
                showAlert('Failed to load course details', 'error');
            }
        }

        // Close course modal
        function closeCourseModal() {
            document.getElementById('courseModal').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        // Continue or start course from modal
        function continueOrStartCourse(courseName) {
            window.location.href = `course-learn.html?course=${encodeURIComponent(courseName)}`;
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('courseModal');
            if (event.target === modal) {
                closeCourseModal();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Page loaded, initializing...');
            
            // Show loading state
            const container = document.getElementById('myCoursesContainer');
            if (container) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem;"><div style="color: #667eea; font-size: 1.2rem;">🔄 Loading your courses...</div></div>';
            }
            
            if (checkAuth()) {
                loadMyCourses();
                
                // Add event listeners for filters
                const statusFilter = document.getElementById('statusFilter');
                const sortBy = document.getElementById('sortBy');
                
                if (statusFilter) statusFilter.addEventListener('change', filterCourses);
                if (sortBy) sortBy.addEventListener('change', filterCourses);
            }
        });
    </script>
    <script src="navbar.js"></script>
</body>
</html>

