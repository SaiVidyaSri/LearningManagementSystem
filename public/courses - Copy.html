<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses - LearnHub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="index.html" class="logo">üìö LearnHub</a>
                <ul class="nav-links" id="navLinks">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="courses.html">Courses</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
                <div class="user-info" id="userInfo">
                    <a href="login.html" class="btn btn-outline">Login</a>
                    <a href="register.html" class="btn btn-primary">Sign Up</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <section style="text-align: center; margin-bottom: 3rem;">
                <h1 style="font-size: 3rem; margin-bottom: 1rem; color: #333;">Explore Our Courses</h1>
                <p style="font-size: 1.2rem; color: #666; max-width: 600px; margin: 0 auto;">
                    Discover a wide range of courses designed to help you learn new skills and advance your career.
                </p>
            </section>

            <!-- Search and Filter Section -->
            <section style="margin-bottom: 3rem;">
                <div class="card">
                    <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 1rem; align-items: end;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="searchInput">Search Courses</label>
                            <input type="text" id="searchInput" class="form-control" placeholder="Search by course name or description...">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="categoryFilter">Category</label>
                            <select id="categoryFilter" class="form-control">
                                <option value="">All Categories</option>
                                <option value="Programming">Programming</option>
                                <option value="Web Development">Web Development</option>
                                <option value="Data Science">Data Science</option>
                                <option value="Design">Design</option>
                                <option value="Business">Business</option>
                                <option value="Marketing">Marketing</option>
                            </select>
                        </div>
                        <button onclick="clearFilters()" class="btn btn-secondary">Clear Filters</button>
                    </div>
                </div>
            </section>

            <!-- Course Statistics -->
            <section style="margin-bottom: 3rem;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalCourses">0</div>
                        <div class="stat-label">Total Courses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">Students Enrolled</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCategories">0</div>
                        <div class="stat-label">Categories</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Support Available</div>
                    </div>
                </div>
            </section>

            <!-- Courses Grid -->
            <section>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="color: #333;">Available Courses</h2>
                    <div style="color: #666;">
                        <span id="courseCount">0</span> courses found
                    </div>
                </div>
                
                <div id="coursesContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- No Results Message -->
                <div id="noResults" style="display: none; text-align: center; padding: 3rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üîç</div>
                    <h3 style="margin-bottom: 1rem; color: #333;">No Courses Found</h3>
                    <p style="color: #666; margin-bottom: 2rem;">Try adjusting your search criteria or browse all courses.</p>
                    <button onclick="clearFilters()" class="btn btn-primary">Clear Filters</button>
                </div>
            </section>
        </div>
    </main>

    <footer style="background: #333; color: white; padding: 2rem 0; text-align: center; margin-top: 4rem;">
        <div class="container">
            <p>&copy; 2025 LearnHub. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let allCourses = [];
        let filteredCourses = [];
        let currentUser = null;

        // Check if user is logged in
        function checkAuth() {
            const user = localStorage.getItem('user');
            if (user) {
                currentUser = JSON.parse(user);
                updateNavigation();
            }
        }

        // Update navigation for logged-in users
        function updateNavigation() {
            const navLinks = document.getElementById('navLinks');
            const userInfo = document.getElementById('userInfo');
            
            if (currentUser) {
                navLinks.innerHTML = `
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="courses.html">Courses</a></li>
                    <li><a href="my-courses.html">My Courses</a></li>
                    <li><a href="progress.html">Progress</a></li>
                `;
                
                userInfo.innerHTML = `
                    <span>Welcome, ${currentUser.username}!</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                `;
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        // Load all courses
        async function loadCourses() {
            try {
                const response = await fetch('/api/courses');
                allCourses = await response.json();
                filteredCourses = [...allCourses];
                
                displayCourses();
                updateStatistics();
                populateCategoryFilter();
                
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('coursesContainer').innerHTML = 
                    '<p style="text-align: center; color: #666;">Unable to load courses at the moment.</p>';
            }
        }

        // Display courses
        function displayCourses() {
            const container = document.getElementById('coursesContainer');
            const courseCount = document.getElementById('courseCount');
            
            courseCount.textContent = filteredCourses.length;
            
            if (filteredCourses.length === 0) {
                container.innerHTML = '';
                document.getElementById('noResults').style.display = 'block';
                return;
            }
            
            document.getElementById('noResults').style.display = 'none';
            
            container.innerHTML = `
                <div class="course-grid">
                    ${filteredCourses.map(course => `
                        <div class="course-card fade-in">
                            <img src="${course.image}" alt="${course.name}" class="course-image" 
                                 onerror="this.src='data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" viewBox=\\"0 0 300 200\\"><rect width=\\"300\\" height=\\"200\\" fill=\\"%23f0f0f0\\"/><text x=\\"150\\" y=\\"100\\" text-anchor=\\"middle\\" fill=\\"%23999\\" font-size=\\"16\\">Course Image</text></svg>'">
                            <div class="course-content">
                                <h3 class="course-title">${course.name}</h3>
                                <p class="course-description">${course.description}</p>
                                <div class="course-meta">
                                    <span>üìÖ ${course.duration} weeks</span>
                                    <span>üìö ${course.category}</span>
                                </div>
                                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                    <a href="course-details.html?course=${encodeURIComponent(course.name)}" 
                                       class="btn btn-primary" style="flex: 1;">View Details</a>
                                    ${currentUser ? `
                                        <button onclick="enrollInCourse('${course.name}')" 
                                                class="btn btn-success" style="flex: 1;" 
                                                id="enroll-${course._id}">Enroll</button>
                                    ` : `
                                        <a href="login.html" class="btn btn-success" style="flex: 1;">Login to Enroll</a>
                                    `}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Check enrollment status for logged-in users
            if (currentUser) {
                checkEnrollmentStatus();
            }
        }

        // Check enrollment status
        async function checkEnrollmentStatus() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`/api/student-progress-details?username=${encodeURIComponent(currentUser.username)}&email=${encodeURIComponent(currentUser.email)}`);
                const enrolledCourses = await response.json();
                
                const enrolledCourseNames = enrolledCourses.map(course => course.courseName);
                
                filteredCourses.forEach(course => {
                    const enrollBtn = document.getElementById(`enroll-${course._id}`);
                    if (enrollBtn && enrolledCourseNames.includes(course.name)) {
                        enrollBtn.textContent = 'Enrolled ‚úì';
                        enrollBtn.disabled = true;
                        enrollBtn.className = 'btn btn-secondary';
                        enrollBtn.style.flex = '1';
                    }
                });
                
            } catch (error) {
                console.error('Error checking enrollment status:', error);
            }
        }

        // Enroll in course
        async function enrollInCourse(courseName) {
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const response = await fetch('/api/enroll', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        courseName: courseName,
                        username: currentUser.username
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Update button state
                    const course = allCourses.find(c => c.name === courseName);
                    const enrollBtn = document.getElementById(`enroll-${course._id}`);
                    if (enrollBtn) {
                        enrollBtn.textContent = 'Enrolled ‚úì';
                        enrollBtn.disabled = true;
                        enrollBtn.className = 'btn btn-secondary';
                    }
                    
                    // Show success message
                    showAlert('Successfully enrolled in ' + courseName + '!', 'success');
                } else {
                    showAlert(result.message || 'Enrollment failed. Please try again.');
                }
                
            } catch (error) {
                console.error('Enrollment error:', error);
                showAlert('Network error. Please try again.');
            }
        }

        // Show alert message
        function showAlert(message, type = 'error') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type === 'success' ? 'alert-success' : 'alert-error'}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.maxWidth = '400px';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Update statistics
        function updateStatistics() {
            const categories = [...new Set(allCourses.map(course => course.category))];
            
            animateNumber('totalCourses', allCourses.length);
            animateNumber('totalCategories', categories.length);
            
            // Load total students count
            loadTotalStudents();
        }

        // Load total students
        async function loadTotalStudents() {
            try {
                const response = await fetch('/api/total-users');
                const data = await response.json();
                animateNumber('totalStudents', data.count || 0);
            } catch (error) {
                console.error('Error loading total students:', error);
            }
        }

        // Populate category filter
        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            const categories = [...new Set(allCourses.map(course => course.category))];
            
            // Clear existing options except "All Categories"
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // Filter courses
        function filterCourses() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedCategory = document.getElementById('categoryFilter').value;
            
            filteredCourses = allCourses.filter(course => {
                const matchesSearch = course.name.toLowerCase().includes(searchTerm) || 
                                    course.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !selectedCategory || course.category === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });
            
            displayCourses();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            filteredCourses = [...allCourses];
            displayCourses();
        }

        // Animate number counting
        function animateNumber(elementId, targetNumber) {
            const element = document.getElementById(elementId);
            const duration = 1500;
            const steps = 30;
            const increment = targetNumber / steps;
            let current = 0;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= targetNumber) {
                    current = targetNumber;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, duration / steps);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadCourses();
            
            // Add search and filter event listeners
            document.getElementById('searchInput').addEventListener('input', filterCourses);
            document.getElementById('categoryFilter').addEventListener('change', filterCourses);
        });
    </script>
</body>
</html>

